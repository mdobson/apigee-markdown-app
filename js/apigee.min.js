window.console=window.console||{},window.console.log=window.console.log||function(){};var Usergrid=function(){function t(t){var e=/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/;return t?e.test(t):!1}function e(t){tail=[];var e=[];if(t instanceof Array)for(i in t)e=t[i],e instanceof Array&&e.length>1&&tail.push(e[0]+"="+encodeURIComponent(e[1]));else for(var o in t)if(t.hasOwnProperty(o)){var n=t[o];if(n instanceof Array)for(i in n)e=n[i],tail.push(o+"="+encodeURIComponent(e));else tail.push(o+"="+encodeURIComponent(n))}return tail.join("&")}return window.Usergrid=window.Usergrid||{},Usergrid=Usergrid||{},Usergrid.USERGRID_SDK_VERSION="0.10.06",Usergrid.Client=function(t){this.URI=t.URI||"https://api.usergrid.com",this.orgName=t.orgName,this.appName=t.appName,this.buildCurl=t.buildCurl||!1,this.logging=t.logging||!1,this._callTimeout=t.callTimeout||3e4,this._callTimeoutCallback=t.callTimeoutCallback||null,this.logoutCallback=t.logoutCallback||null},Usergrid.Client.prototype.request=function(t,i){var o=this,n=t.method||"GET",r=t.endpoint,s=t.body||{},a=t.qs||{},l=t.mQuery||!1;if(l)var c=this.URI+"/"+r;else var c=this.URI+"/"+this.orgName+"/"+this.appName+"/"+r;o.getToken()&&(a.access_token=o.getToken());var g=e(a);g&&(c+="?"+g),s=JSON.stringify(s);var u=new XMLHttpRequest;u.open(n,c,!0),s&&(u.setRequestHeader("Content-Type","application/json"),u.setRequestHeader("Accept","application/json")),u.onerror=function(){o._end=(new Date).getTime(),o.logging&&console.log("success (time: "+o.calcTimeDiff()+"): "+n+" "+c),o.logging&&console.log("Error: API call failed at the network level."),clearTimeout(p);var t=!0;"function"==typeof i&&i(t,data)},u.onload=function(t){if(o._end=(new Date).getTime(),o.logging&&console.log("success (time: "+o.calcTimeDiff()+"): "+n+" "+c),clearTimeout(p),t=JSON.parse(u.responseText),200!=u.status){var e=t.error,r=t.error_description;if(o.logging&&console.log("Error ("+u.status+")("+e+"): "+r),("auth_expired_session_token"==e||"unauthorized"==e||"auth_missing_credentials"==e||"auth_invalid"==e)&&"function"==typeof o.logoutCallback)return o.logoutCallback(!0,t);"function"==typeof i&&i(!0,t)}else"function"==typeof i&&i(!1,t)};var p=setTimeout(function(){u.abort(),"function"===o._callTimeoutCallback?o._callTimeoutCallback("API CALL TIMEOUT"):o.callback("API CALL TIMEOUT")},o._callTimeout);if(this.logging&&console.log("calling: "+n+" "+c),this.buildCurl){var d={uri:c,body:s,method:n};this.buildCurlCall(d)}this._start=(new Date).getTime(),u.send(s)},Usergrid.Client.prototype.createGroup=function(t,e){var i=t.getOnExist||!1,t={path:t.path,client:this,data:t},o=new Usergrid.Group(t);o.fetch(function(t,n){var r=t&&"service_resource_not_found"===n.error||"no_name_specified"===n.error||"null_pointer"===n.error||!t&&i;r?o.save(function(t){"function"==typeof e&&e(t,o)}):"function"==typeof e&&e(t,o)})},Usergrid.Client.prototype.createEntity=function(t,e){var i=t.getOnExist||!1,t={client:this,data:t},o=new Usergrid.Entity(t);o.fetch(function(n,r){var s=n&&"service_resource_not_found"===r.error||"no_name_specified"===r.error||"null_pointer"===r.error||!n&&i;s?(o.set(t.data),o.save(function(t){"function"==typeof e&&e(t,o)})):"function"==typeof e&&e(n,o)})},Usergrid.Client.prototype.restoreEntity=function(t){var e=JSON.parse(t),i={client:this,data:e},o=new Usergrid.Entity(i);return o},Usergrid.Client.prototype.getEntity=function(t,e){var t={client:this,data:t},i=new Usergrid.Entity(t);i.fetch(function(t){"function"==typeof e&&e(t,i)})},Usergrid.Client.prototype.createCollection=function(t,e){t.client=this;var i=new Usergrid.Collection(t,function(t){"function"==typeof e&&e(t,i)})},Usergrid.Client.prototype.restoreCollection=function(t){var e=JSON.parse(t);e.client=this;var i=new Usergrid.Collection(e);return i},Usergrid.Client.prototype.getFeedForUser=function(t,e){var i={method:"GET",endpoint:"users/"+t+"/feed"};this.request(i,function(t,i){"function"==typeof e&&(t?e(t):e(t,i,i.entities))})},Usergrid.Client.prototype.createUserActivity=function(t,e,i){e.type="users/"+t+"/activities";var e={client:this,data:e},o=new Usergrid.Entity(e);o.save(function(t){"function"==typeof i&&i(t,o)})},Usergrid.Client.prototype.createUserActivityWithEntity=function(t,e,i){var o=t.get("username"),n={actor:{displayName:o,uuid:t.get("uuid"),username:o,email:t.get("email"),picture:t.get("picture"),image:{duration:0,height:80,url:t.get("picture"),width:80}},verb:"post",content:e};this.createUserActivity(o,n,i)},Usergrid.Client.prototype.calcTimeDiff=function(){var t=0,e=this._end-this._start;try{t=(e/10/60).toFixed(2)}catch(i){return 0}return t},Usergrid.Client.prototype.setToken=function(t){var e="token"+this.appName+this.orgName;this.token=t,"undefined"!=typeof Storage&&(t?localStorage.setItem(e,t):localStorage.removeItem(e))},Usergrid.Client.prototype.getToken=function(){var t="token"+this.appName+this.orgName;return this.token?this.token:"undefined"!=typeof Storage?localStorage.getItem(t):null},Usergrid.Client.prototype.signup=function(t,e,i,o,n){var r={type:"users",username:t,password:e,email:i,name:o};this.createEntity(r,n)},Usergrid.Client.prototype.login=function(t,e,i){var o=this,n={method:"POST",endpoint:"token",body:{username:t,password:e,grant_type:"password"}};this.request(n,function(t,e){var n={};if(t&&o.logging)console.log("error trying to log user in");else{var r={client:o,data:e.user};n=new Usergrid.Entity(r),o.setToken(e.access_token)}"function"==typeof i&&i(t,e,n)})},Usergrid.Client.prototype.loginFacebook=function(t,e){var i=this,o={method:"GET",endpoint:"auth/facebook",qs:{fb_access_token:t}};this.request(o,function(t,o){var n={};if(t&&i.logging)console.log("error trying to log user in");else{var r={client:i,data:o.user};n=new Usergrid.Entity(r),i.setToken(o.access_token)}"function"==typeof e&&e(t,o,n)})},Usergrid.Client.prototype.getLoggedInUser=function(t){if(this.getToken()){var e=this,i={method:"GET",endpoint:"users/me"};this.request(i,function(i,o){if(i)e.logging&&console.log("error trying to log user in"),"function"==typeof t&&t(i,o,null);else{var n={client:e,data:o.entities[0]},r=new Usergrid.Entity(n);"function"==typeof t&&t(i,o,r)}})}else t(!0,null,null)},Usergrid.Client.prototype.isLoggedIn=function(){return this.getToken()?!0:!1},Usergrid.Client.prototype.logout=function(){this.setToken(null)},Usergrid.Client.prototype.buildCurlCall=function(t){var e="curl",i=(t.method||"GET").toUpperCase(),o=t.body||{},n=t.uri;return e+="POST"===i?" -X POST":"PUT"===i?" -X PUT":"DELETE"===i?" -X DELETE":" -X GET",e+=" "+n,'"{}"'!==o&&"GET"!==i&&"DELETE"!==i&&(e+=" -d '"+o+"'"),console.log(e),e},Usergrid.Entity=function(t){t&&(this._client=t.client,this._data=t.data||{})},Usergrid.Entity.prototype.serialize=function(){return JSON.stringify(this._data)},Usergrid.Entity.prototype.get=function(t){return t?this._data[t]:this._data},Usergrid.Entity.prototype.set=function(t,e){if("object"==typeof t)for(var i in t)this._data[i]=t[i];else"string"==typeof t?null===e?delete this._data[t]:this._data[t]=e:this._data=null},Usergrid.Entity.prototype.save=function(e){var i=this.get("type"),o="POST";t(this.get("uuid"))&&(o="PUT",i+="/"+this.get("uuid"));var n=this,r={},s=this.get();for(var a in s)"metadata"!==a&&"created"!==a&&"modified"!==a&&"type"!==a&&"activated"!==a&&"uuid"!==a&&(r[a]=s[a]);var l={method:o,endpoint:i,body:r};this._client.request(l,function(t,o){if(t&&n._client.logging){if(console.log("could not save entity"),"function"==typeof e)return e(t,o,n)}else{if(o.entities&&o.entities.length){var r=o.entities[0];n.set(r)}var a="user"===n.get("type")&&s.oldpassword&&s.newpassword;if(a){var l={};l.oldpassword=s.oldpassword,l.newpassword=s.newpassword;var c={method:"PUT",endpoint:i+"/password",body:l};n._client.request(c,function(t,i){t&&n._client.logging&&console.log("could not update user"),n.set("oldpassword",null),n.set("newpassword",null),"function"==typeof e&&e(t,i,n)})}else"function"==typeof e&&e(t,o,n)}})},Usergrid.Entity.prototype.fetch=function(t){var e=this.get("type"),i=this;if(this.get("uuid"))e+="/"+this.get("uuid");else if("users"===e){if(this.get("username"))e+="/"+this.get("username");else if("function"==typeof t){var o="cannot fetch entity, no username specified";return i._client.logging&&console.log(o),t(!0,o,i)}}else if(this.get("name"))e+="/"+encodeURIComponent(this.get("name"));else if("function"==typeof t){var o="cannot fetch entity, no name specified";return i._client.logging&&console.log(o),t(!0,o,i)}var n={method:"GET",endpoint:e};this._client.request(n,function(e,o){if(e&&i._client.logging)console.log("could not get entity");else if(o.user)i.set(o.user);else if(o.entities&&o.entities.length){var n=o.entities[0];i.set(n)}"function"==typeof t&&t(e,o,i)})},Usergrid.Entity.prototype.destroy=function(e){var i=this.get("type");if(t(this.get("uuid")))i+="/"+this.get("uuid");else if("function"==typeof e){var o="Error trying to delete object - no uuid specified.";n._client.logging&&console.log(o),e(!0,o)}var n=this,r={method:"DELETE",endpoint:i};this._client.request(r,function(t,i){t&&n._client.logging?console.log("entity could not be deleted"):n.set(null),"function"==typeof e&&e(t,i)})},Usergrid.Entity.prototype.connect=function(t,e,i){var o=this,n=e.get("type"),r=this.getEntityId(e);if(r){var s=this.get("type"),a=this.getEntityId(this);if(a){var l=s+"/"+a+"/"+t+"/"+n+"/"+r,c={method:"POST",endpoint:l};this._client.request(c,function(t,e){t&&o._client.logging&&console.log("entity could not be connected"),"function"==typeof i&&i(t,e)})}else if("function"==typeof i){var g="Error in connect - no uuid specified.";o._client.logging&&console.log(g),i(!0,g)}}else if("function"==typeof i){var g="Error trying to delete object - no uuid specified.";o._client.logging&&console.log(g),i(!0,g)}},Usergrid.Entity.prototype.getEntityId=function(e){var i=!1;return t(e.get("uuid"))?i=e.get("uuid"):"users"===type?i=e.get("username"):e.get("name")&&(i=e.get("name")),i},Usergrid.Entity.prototype.getConnections=function(t,e){var i=this,o=this.get("type"),n=this.getEntityId(this);if(n){var r=o+"/"+n+"/"+t+"/",s={method:"GET",endpoint:r};this._client.request(s,function(o,n){o&&i._client.logging&&console.log("entity could not be connected"),i[t]={};for(var r=n.entities.length,s=0;r>s;s++)"user"===n.entities[s].type?i[t][n.entities[s].username]=n.entities[s]:i[t][n.entities[s].name]=n.entities[s];"function"==typeof e&&e(o,n,n.entities)})}else if("function"==typeof e){var a="Error in getConnections - no uuid specified.";i._client.logging&&console.log(a),e(!0,a)}},Usergrid.Entity.prototype.disconnect=function(t,e,i){var o=this,n=e.get("type"),r=this.getEntityId(e);if(r){var s=this.get("type"),a=this.getEntityId(this);if(a){var l=s+"/"+a+"/"+t+"/"+n+"/"+r,c={method:"DELETE",endpoint:l};this._client.request(c,function(t,e){t&&o._client.logging&&console.log("entity could not be disconnected"),"function"==typeof i&&i(t,e)})}else if("function"==typeof i){var g="Error in connect - no uuid specified.";o._client.logging&&console.log(g),i(!0,g)}}else if("function"==typeof i){var g="Error trying to delete object - no uuid specified.";o._client.logging&&console.log(g),i(!0,g)}},Usergrid.Collection=function(t,e){if(t&&(this._client=t.client,this._type=t.type,this.qs=t.qs||{},this._list=t.list||[],this._iterator=t.iterator||-1,this._previous=t.previous||[],this._next=t.next||null,this._cursor=t.cursor||null,t.list))for(var i=t.list.length,o=0;i>o;o++){var n=this._client.restoreEntity(t.list[o]);this._list[o]=n}e&&this.fetch(e)},Usergrid.Collection.prototype.serialize=function(){var t={};t.type=this._type,t.qs=this.qs,t.iterator=this._iterator,t.previous=this._previous,t.next=this._next,t.cursor=this._cursor,this.resetEntityPointer();var e=0;for(t.list=[];this.hasNextEntity();){var i=this.getNextEntity();t.list[e]=i.serialize(),e++}return t=JSON.stringify(t)},Usergrid.Collection.prototype.fetch=function(t){var e=this,i=this.qs;this._cursor?i.cursor=this._cursor:delete i.cursor;var o={method:"GET",endpoint:this._type,qs:this.qs};this._client.request(o,function(i,o){if(i&&e._client.logging)console.log("error getting collection");else{var n=o.cursor||null;if(e.saveCursor(n),o.entities){e.resetEntityPointer();var r=o.entities.length;e._list=[];for(var s=0;r>s;s++){var a=o.entities[s].uuid;if(a){var l=o.entities[s]||{},c={type:e._type,client:e._client,uuid:a,data:l},g=new Usergrid.Entity(c),u=e._list.length;e._list[u]=g}}}}"function"==typeof t&&t(i,o)})},Usergrid.Collection.prototype.addEntity=function(t,e){var i=this;t.type=this._type,this._client.createEntity(t,function(t,o){if(!t){var n=i._list.length;i._list[n]=o}"function"==typeof e&&e(t,o)})},Usergrid.Collection.prototype.destroyEntity=function(t,e){var i=this;t.destroy(function(t,o){t?(i._client.logging&&console.log("could not destroy entity"),"function"==typeof e&&e(t,o)):i.fetch(e)})},Usergrid.Collection.prototype.getEntityByUUID=function(t,e){var i={data:{type:this._type,uuid:t},client:this._client},o=new Usergrid.Entity(i);o.fetch(e)},Usergrid.Collection.prototype.getFirstEntity=function(){var t=this._list.length;return t>0?this._list[0]:null},Usergrid.Collection.prototype.getLastEntity=function(){var t=this._list.length;return t>0?this._list[t-1]:null},Usergrid.Collection.prototype.hasNextEntity=function(){var t=this._iterator+1,e=t>=0&&this._list.length>t;return e?!0:!1},Usergrid.Collection.prototype.getNextEntity=function(){this._iterator++;var t=this._iterator>=0&&this._iterator<=this._list.length;return t?this._list[this._iterator]:!1},Usergrid.Collection.prototype.hasPrevEntity=function(){var t=this._iterator-1,e=t>=0&&this._list.length>t;return e?!0:!1},Usergrid.Collection.prototype.getPrevEntity=function(){this._iterator--;var t=this._iterator>=0&&this._iterator<=this._list.length;return t?this.list[this._iterator]:!1},Usergrid.Collection.prototype.resetEntityPointer=function(){this._iterator=-1},Usergrid.Collection.prototype.saveCursor=function(t){this._next!==t&&(this._next=t)},Usergrid.Collection.prototype.resetPaging=function(){this._previous=[],this._next=null,this._cursor=null},Usergrid.Collection.prototype.hasNextPage=function(){return this._next},Usergrid.Collection.prototype.getNextPage=function(t){this.hasNextPage()&&(this._previous.push(this._cursor),this._cursor=this._next,this._list=[],this.fetch(t))},Usergrid.Collection.prototype.hasPreviousPage=function(){return this._previous.length>0},Usergrid.Collection.prototype.getPreviousPage=function(t){this.hasPreviousPage()&&(this._next=null,this._cursor=this._previous.pop(),this._list=[],this.fetch(t))},Usergrid.Group=function(t){this._path=t.path,this._list=[],this._client=t.client,this._data=t.data||{},this._data.type="groups"},Usergrid.Group.prototype=new Usergrid.Entity,Usergrid.Group.prototype.fetch=function(t){var e=this,i="groups/"+this._path,o="groups/"+this._path+"/users",n={method:"GET",endpoint:i},r={method:"GET",endpoint:o};this._client.request(n,function(i,o){if(i)e._client.logging&&console.log("error getting group"),"function"==typeof t&&t(i,o);else if(o.entities){var n=o.entities[0];e._data=n||{},e._client.request(r,function(i,o){if(i&&e._client.logging)console.log("error getting group users");else if(o.entities){var n=o.entities.length;e._list=[];for(var r=0;n>r;r++){var s=o.entities[r].uuid;if(s){var a=o.entities[r]||{},l={type:a.type,client:e._client,uuid:s,data:a},c=new Usergrid.Entity(l);e._list.push(c)}}}"function"==typeof t&&t(i,o,e._list)})}})},Usergrid.Group.prototype.members=function(t){"function"==typeof t&&t(null,this._list)},Usergrid.Group.prototype.add=function(t,e){var i=this,t={method:"POST",endpoint:"groups/"+this._path+"/users/"+t.user.get("username")};this._client.request(t,function(t,o){t?"function"==typeof e&&e(t,o,o.entities):i.fetch(e)})},Usergrid.Group.prototype.remove=function(t,e){var i=this,t={method:"DELETE",endpoint:"groups/"+this._path+"/users/"+t.user.get("username")};this._client.request(t,function(t,o){t?"function"==typeof e&&e(t,o):i.fetch(e)})},Usergrid.Group.prototype.feed=function(t){var e=this,i="groups/"+this._path+"/feed",o={method:"GET",endpoint:i};this._client.request(o,function(i,o){i&&e.logging&&console.log("error trying to log user in"),"function"==typeof t&&t(i,o,o.entities)})},Usergrid.Group.prototype.createGroupActivity=function(t,e){var i=t.user,t={actor:{displayName:i.get("username"),uuid:i.get("uuid"),username:i.get("username"),email:i.get("email"),picture:i.get("picture"),image:{duration:0,height:80,url:i.get("picture"),width:80}},verb:"post",content:t.content};t.type="groups/"+this._path+"/activities";var t={client:this._client,data:t},o=new Usergrid.Entity(t);o.save(function(t){"function"==typeof e&&e(t,o)})},Usergrid}(),Apigee=function(){function t(t){var e=t||{},o={logLevel:l.assert,logMessage:e.logMessage,tag:e.tag,timeStamp:i()};u.push(o)}function e(){for(var t=[],e="0123456789ABCDEF",i=0;36>i;i++)t[i]=Math.floor(16*Math.random());t[14]=4,t[19]=8|3&t[19];for(var i=0;36>i;i++)t[i]=e[t[i]];return t[8]=t[13]=t[18]=t[23]="-",t.join("")}function i(){return""+(new Date).getTime()}function o(){if(null===typeof window.localStorage.getItem("uuid"))return window.localStorage.getItem("uuid");var t=e();return window.localStorage.setItem("uuid",t),window.localStorage.getItem("uuid")}function n(){return window.device!==void 0}function r(){return window.forge!==void 0}function s(){return"undefined"!=typeof Titanium}var a={get:"GET",post:"POST",put:"PUT",del:"DELETE",head:"HEAD"},l={verbose:"V",debug:"D",info:"I",warn:"W",error:"E",assert:"A"},c={verbose:2,debug:3,info:4,warn:5,error:6,assert:7},g="UNKNOWN",u=[],p=[],d=Usergrid;return d.MobileAnalytics=function(t){if(this.orgName=t.orgName,this.appName=t.appName,this.syncOnClose=t.syncOnClose||!1,this.testMode=t.testMode||!1,this.apiUrl=t.apiUrl===void 0?"https://api.usergrid.org/":t.apiUrl,this.syncDate=i(),t.config!==void 0?(this.configuration=t.config,this.deviceConfig=this.configuration.deviceLevelOverrideEnabled===!0?this.configuration.deviceLevelAppConfig:this.abtestingOverrideEnabled===!0?this.configuration.abtestingAppConfig:this.configuration.defaultAppConfig):this.downloadConfig(),null!==this.configuration){var e=0;if(100>this.deviceConfig.samplingRate&&(e=Math.floor(101*Math.random())),this.deviceConfig.samplingRate>e){this.appId=this.configuration.instaOpsApplicationId,this.deviceConfig.enableLogMonitoring&&this.patchLoggingCalls();var o=3e3;this.deviceConfig.agentUploadIntervalInSeconds!==void 0&&(o=1e3*this.deviceConfig.agentUploadIntervalInSeconds);var a=this;this.syncOnClose?n()?window.addEventListener("pause",function(){a.prepareSync()},!1):r()?forge.event.appPaused.addListener(function(){},function(t){console.log("Error syncing data."),console.log(t)}):s()||window.addEventListener("beforeunload",function(){a.prepareSync()}):setInterval(function(){a.prepareSync()},o),this.deviceConfig.networkMonitoringEnabled&&this.patchNetworkCalls(XMLHttpRequest),window.onerror=d.MobileAnalytics.catchCrashReport}}else console.log("Error configuration unavailable.")},d.MobileAnalytics.prototype.downloadConfig=function(t){var e=new XMLHttpRequest,i=this.apiUrl+this.orgName+"/"+this.appName+"/apm/apigeeMobileConfig";if("function"==typeof t)e.open(a.get,i,!0),e.setRequestHeader("Accept","application/json"),e.setRequestHeader("Content-Type","application/json"),e.onreadystatechange=onreadystatechange,e.send();else if(e.open(a.get,i,!1),e.setRequestHeader("Accept","application/json"),e.setRequestHeader("Content-Type","application/json"),e.send(),200===e.status){var o=JSON.parse(e.responseText);this.configuration=o,this.deviceConfig=o.deviceLevelOverrideEnabled===!0?o.deviceLevelAppConfig:this.abtestingOverrideEnabled===!0?o.abtestingAppConfig:o.defaultAppConfig}else this.configuration=null},d.MobileAnalytics.prototype.sync=function(t){var e={};e.logs=t.logs,e.metrics=t.metrics,e.sessionMetrics=this.sessionMetrics,e.orgName=this.orgName,e.appName=this.appName,e.fullAppName=this.orgName+"_"+this.appName,e.instaOpsApplicationId=this.configuration.instaOpsApplicationId,e.timeStamp=i();var o=new XMLHttpRequest,n=this.apiUrl+this.orgName+"/"+this.appName+"/apm/apmMetrics";if(o.open(a.post,n,!1),o.setRequestHeader("Accept","application/json"),o.setRequestHeader("Content-Type","application/json"),o.send(JSON.stringify(e)),200===o.status){u=[],p=[];var r=o.responseText;console.log(r)}else console.log("Error syncing"),console.log(o.responseText)},d.MobileAnalytics.catchCrashReport=function(e,i,o){t({tag:"CRASH",logMessage:"Error:"+e+" for url:"+i+" on line:"+o})},d.MobileAnalytics.prototype.startSession=function(){var t=this,a={};if(a.timeStamp=i(),a.networkCarrier=g,a.deviceCountry=g,a.batteryLevel="-100",a.networkSubType=g,a.networkCountry=g,a.sessionId=e(),a.applicationVersion="1.0",a.appId=""+this.appId,this.deviceConfig.locationCaptureEnabled&&navigator.geolocation!==void 0&&navigator.geolocation.getCurrentPosition(function(e){t.sessionMetrics.latitude=e.coords.latitude,t.sessionMetrics.longitude=e.coords.longitude}),n())a.devicePlatform=window.device.platform,a.deviceOSVersion=window.device.version,a.deviceId=this.deviceConfig.deviceIdCaptureEnabled?this.deviceConfig.obfuscateDeviceId?o():window.device.uuid:this.deviceConfig.obfuscateDeviceId?o():g,a.deviceModel=window.device.name,a.networkType=navigator.connection.type;else if(r()){var l=g;forge.is.ios()?l="iOS":forge.is.android()&&(l="Android"),a.devicePlatform=g,a.deviceOSVersion=l,a.deviceId=this.deviceConfig.deviceIdCaptureEnabled?o():g,a.deviceModel=g,a.networkType=forge.is.connection.wifi()?"WIFI":g}else if(s()){var t=this;Ti.App.addEventListener("analytics:platformMetrics",function(e){t.sessionMetrics.devicePlatform=e.name,t.sessionMetrics.deviceOSVersion=e.osname,t.sessionMetrics.deviceId=t.deviceConfig.deviceIdCaptureEnabled?t.deviceConfig.obfuscateDeviceId?o():e.uuid:t.deviceConfig.obfuscateDeviceId?o():g,t.sessionMetrics.deviceModel=e.model,t.sessionMetrics.networkType=e.networkType})}else{if(window.localStorage!==void 0&&(a.deviceId=this.deviceConfig.deviceIdCaptureEnabled?o():g),navigator.userAgent!==void 0){var c=navigator.userAgent.toLowerCase(),u=g;u=/ipad/.test(c)?"iPad":/iphone/.test(c)?"iPhone":/android/.test(c)?"Android":/webos/.test(c)?"WebOS":navigator.platform,a.platform=u}if(navigator.platform!==void 0){var p="";a.devicePlatform=p}a.deviceOSVersion=g,navigator.language!==void 0&&(a.localLanguage=navigator.language)}this.sessionMetrics=a,s()&&Ti.App.fireEvent("analytics:attachReady")},d.MobileAnalytics.prototype.patchNetworkCalls=function(t){"use strict";var e=this,o=t.prototype.open,n=t.prototype.send;t.prototype.open=function(t,e,i,n,r){this._method=t,this._url=e,o.call(this,t,e,i,n,r)},t.prototype.send=function(t){function o(){if(4==a.readyState&&-1===l.indexOf("/!gap_exec")&&-1===l.indexOf(e.apiUrl)){var t=i(),o=t-r,n={url:l,startTime:""+r,endTime:""+t,numSamples:"1",latency:""+o,timeStamp:""+r,httpStatusCode:""+a.status,responseDataSize:""+a.responseText.length};200==a.status?(n.numErrors="0",console.log(JSON.stringify(n)),e.logNetworkCall(n)):(n.numErrors="1",e.logNetworkCall(n))}s&&s()}var r,s,a=this;this._method;var l=this._url;this.noIntercept||(r=i(),this.addEventListener?this.addEventListener("readystatechange",o,!1):(s=this.onreadystatechange,this.onreadystatechange=o)),n.call(this,t)}},d.MobileAnalytics.prototype.patchLoggingCalls=function(){var t=this,e=window.console;if(window.console={log:function(){t.logInfo({tag:"CONSOLE",logMessage:arguments[0]}),e.log.apply(e,arguments)},warn:function(){t.logWarn({tag:"CONSOLE",logMessage:arguments[0]}),e.warn.apply(e,arguments)},error:function(){t.logError({tag:"CONSOLE",logMessage:arguments[0]}),e.error.apply(e,arguments)},assert:function(){t.logAssert({tag:"CONSOLE",logMessage:arguments[1]}),e.assert.apply(e,arguments)},debug:function(){t.logDebug({tag:"CONSOLE",logMessage:arguments[0]}),e.debug.apply(e,arguments)}},s()){var i=Ti.API;window.console.log=function(){i.info.apply(i,arguments)},Ti.API={info:function(){t.logInfo({tag:"CONSOLE_TITANIUM",logMessage:arguments[0]}),i.info.apply(i,arguments)},log:function(){var e=arguments[0];"info"===e?t.logInfo({tag:"CONSOLE_TITANIUM",logMessage:arguments[1]}):"warn"===e?t.logWarn({tag:"CONSOLE_TITANIUM",logMessage:arguments[1]}):"error"===e?t.logError({tag:"CONSOLE_TITANIUM",logMessage:arguments[1]}):"debug"===e?t.logDebug({tag:"CONSOLE_TITANIUM",logMessage:arguments[1]}):"trace"===e?t.logAssert({tag:"CONSOLE_TITANIUM",logMessage:arguments[1]}):t.logInfo({tag:"CONSOLE_TITANIUM",logMessage:arguments[1]}),i.log.apply(i,arguments)}}}},d.MobileAnalytics.prototype.prepareSync=function(){var t={},e=this;e.sessionMetrics!==void 0&&(t.sessionMetrics=e.sessionMetrics);var o=!1;this.syncDate=i(),p.length>0&&(o=!0),u.length>0&&(o=!0),t.logs=u,t.metrics=p,o&&!e.testMode&&this.sync(t)},d.MobileAnalytics.prototype.logMessage=function(t){var e=t||{},o={logLevel:e.logLevel,logMessage:e.logMessage.substring(0,250),tag:e.tag,timeStamp:i()};u.push(o)},d.MobileAnalytics.prototype.logVerbose=function(t){var e=t||{};e.logLevel=l.verbose,this.deviceConfig.logLevelToMonitor>=c.verbose&&this.logMessage(t)},d.MobileAnalytics.prototype.logDebug=function(t){var e=t||{};e.logLevel=l.debug,this.deviceConfig.logLevelToMonitor>=c.debug&&this.logMessage(t)},d.MobileAnalytics.prototype.logInfo=function(t){var e=t||{};e.logLevel=l.info,this.deviceConfig.logLevelToMonitor>=c.info&&this.logMessage(t)},d.MobileAnalytics.prototype.logWarn=function(t){var e=t||{};e.logLevel=l.warn,this.deviceConfig.logLevelToMonitor>=c.warn&&this.logMessage(t)},d.MobileAnalytics.prototype.logError=function(t){var e=t||{};e.logLevel=l.error,this.deviceConfig.logLevelToMonitor>=c.error&&this.logMessage(t)},d.MobileAnalytics.prototype.logAssert=function(t){var e=t||{};e.logLevel=l.assert,this.deviceConfig.logLevelToMonitor>=c.assert&&this.logMessage(t)},d.MobileAnalytics.prototype.logNetworkCall=function(t){p.push(t)},d.MobileAnalytics.prototype.getConfig=function(){},d.MobileAnalytics.prototype.logs=function(){return u},d.MobileAnalytics.prototype.metrics=function(){return p},d.MobileAnalytics.prototype.sessionMetrics=function(){return this.sessionMetrics},d.MobileAnalytics.prototype.clearMetrics=function(){u=[],p=[]},d}();